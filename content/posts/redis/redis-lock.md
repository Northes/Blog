---
title: "Redis 分布式锁实现原理演进历程"
date: 2021-12-31T23:36:46+08:00
draft: true
author : "Northes"
description: "Redis分布式锁原理与实战总结"
tags: ["学习笔记"]
---


> 参考：https://mp.weixin.qq.com/s/k6aRXDwGVDkg54pZWQyx4A
>
> 将原文代码使用 Go 实现 

Redis 分布式锁使用 `SET` 指令就可以实现了么？在分布式领域 `CAP` 理论一直存在

分布式锁可没那么简单，我们在网上看到的分布式锁方案可能是有问题的

分布式锁是如何完善的？如何实现在高并发生产环境可用的分布式锁？

在进入正文之前，我们先带着问题去思考：

- 什么时候需要分布式锁
- 加锁、解锁的代码位置有讲究么？
- 如何避免出现锁再也无法删除？
- 超时时间设置多少合适？
- 如何避免锁被其他线程释放？
- 如何实现重入锁？
- 主从架构会带来什么安全问题？
- 什么是 `RedLock` ？
- Redisson 分布式锁最佳时间
- 看门狗实现原理



## 什么时候需要分布式锁

共享资源需要抢占式使用时

## 加、解锁代码的位置有讲究么？

```go
defer unlock()
```

## 如何避免锁再也无法删除？

基本同上，使用 `defer` 

## 超时时间设置多少合适？

1. 一般需要经过压测确定
2. 开协程续期

## 如何避免锁被其他线程释放？

value 设置线程独有value，value 与当前线程的不一致，则不释放

## 如何实现重入锁？

计数

## 主从架构会带来什么安全问题？

主节点加锁成功，还没来得及同步到从节点，此时从节点当选为Master，其他线程获取锁成功

## 什么是`RedLock` ?

redis 官方推荐的一种分布式锁实现机制

## Redission 分布式锁最佳实践

待定，改用 go 的包

## 看门狗实现原理



